{
  "info": {
    "name": "Supabase - Testes (Bread&Meat)",
    "_postman_id": "00000000-0000-4000-8000-000000000000",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth - Sign In (obter ACCESS_TOKEN)",
      "request": {
        "method": "POST",
        "header": [
          {"key": "apikey", "value": "{{ANON_KEY}}"},
          {"key": "Content-Type", "value": "application/json"}
        ],
        "url": {
          "raw": "{{PROJECT_URL}}/auth/v1/token?grant_type=password",
          "host": ["{{PROJECT_URL}}"],
          "path": ["auth","v1","token"],
          "query": [{"key":"grant_type","value":"password"}]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"email\": \"{{EMAIL}}\", \"password\": \"{{PASSWORD}}\"}"
        }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "const resp = pm.response.json();",
            "if (resp && resp.access_token) {",
            "  pm.environment.set('ACCESS_TOKEN', resp.access_token);",
            "  pm.test('ACCESS_TOKEN definido', function () { pm.expect(pm.environment.get('ACCESS_TOKEN')).to.be.a('string'); });",
            "} else {",
            "  pm.test('Falha ao obter access_token', function () { pm.expect(false).to.be.true; });",
            "}"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "REST - Listar pedidos (com filtros)",
      "request": {
        "method": "GET",
        "header": [
          {"key": "apikey", "value": "{{ANON_KEY}}"},
          {"key": "Authorization", "value": "Bearer {{ACCESS_TOKEN}}"}
        ],
        "url": {
          "raw": "{{PROJECT_URL}}/rest/v1/pedidos?select=*&status=eq.{{STATUS}}&created_at=gte.{{DATA}}T00:00:00Z&created_at=lte.{{DATA}}T23:59:59Z",
          "host": ["{{PROJECT_URL}}"],
          "path": ["rest","v1","pedidos"],
          "query": [
            {"key":"select","value":"*"},
            {"key":"status","value":"eq.{{STATUS}}"},
            {"key":"created_at","value":"gte.{{DATA}}T00:00:00Z"},
            {"key":"created_at","value":"lte.{{DATA}}T23:59:59Z"}
          ]
        }
      }
    },
    {
      "name": "REST - Alterar status do pedido",
      "request": {
        "method": "PATCH",
        "header": [
          {"key": "apikey", "value": "{{ANON_KEY}}"},
          {"key": "Authorization", "value": "Bearer {{ACCESS_TOKEN}}"},
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Prefer", "value": "return=representation"}
        ],
        "url": {
          "raw": "{{PROJECT_URL}}/rest/v1/pedidos?id=eq.{{PEDIDO_ID}}",
          "host": ["{{PROJECT_URL}}"],
          "path": ["rest","v1","pedidos"],
          "query": [{"key":"id","value":"eq.{{PEDIDO_ID}}"}]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"status\": \"{{NOVO_STATUS}}\"}"
        }
      }
    }
  ]
}
