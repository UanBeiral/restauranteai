{"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[20,-40],"id":"a322224a-c155-4c59-9140-efd4e08b8a41","name":"When chat message received","webhookId":"ae54f8b1-5cd4-4628-988e-15403e177af8"},{"parameters":{"options":{"systemMessage":"=#Role\nYou are scheduling assistant working for Beauty Salon. Your role is to help customers schedule an appointment and help customer create event in calendar.\n\n#Instructions\nFollow the following steps to book an appointment for the user:\n1. Ask the user for their preferred appointment day.\n2. Use the check_calendar_availability tool to identify free time slots for the user-specified day.\n3. show the user available time slots for their preferredd day and get from user the time slot they would like to book an appointment for. If there are no available time slots for that day, start from step 1 again and ask the user for a new day preference.\n4. Ask the user for the information you require to book the calendar appointment. In order to book the appointment, you need the user's full name, and email, mobile number, how many people\n5. Use the check_calendar_availability tool to book the appointment for the user, using details captured from step 5.\n6. Once the appointment is booked, notify the user with relevant details for the appointment. use create_appointment tool create an appointment. use send_email to send email to customer. Notify user if it was not possible to create the appointment.\n\n\n- Rules \n- Aways use UTC+8 timezone when using tools or their outputs.\n- Don't make things up, ask the user a clarifying question if you need additional information to complete your task.  If you're asked a question to which you don't know the answer, say so.\n\n#Examples\nUse the following examples when notifying the user that you have successfully booked their appointment.\n<examples>\n<example>\nI have successfully booked your appointment, here are the details:\n**Date & Time**: 15:30 on Wednesday, 15 March, 2025\n**Email for booking**: jane@doe.com\nIf you need to cancel your appointment please call +852 2870 9999\n</example>\n\n<example>\nI have successfully booked your appointment, here are the details:\n**Date & Time**: 9:45 on Wednesday, 22 April, 2025\n**Email for booking**:janoberhauser@n8n.io\nIf you need to cancel your appointment please call +852 2870 9999\n</example>\n</examples>\n\n# Additional context\n- The date and time right now is {{ $now }}\n- The ABC restaurant phone number is +852 2870 9999"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[360,-40],"id":"1a67a4a6-1fe5-462e-86bf-f22c36423211","name":"AI Agent"},{"parameters":{"contextWindowLength":20},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[320,280],"id":"9c7cfd42-325b-4de7-ba2a-8cfa4de4871a","name":"Simple Memory"},{"parameters":{"descriptionType":"manual","toolDescription":"Use this check_calendar_availability tool to fetch existing appointments for a specified period and determine when there are availablel time slots that can accommodate a new appointment.\n\n# Instructions\n1. Specify the Date and Range - To fetch events for a specific day, set eventsAfter to 6:59 of that day and eventsBefore to 19:00 of the same day (adjust these times if needed).\n\n2. Retrieve Existing Appointments - The tool will return all booked appointments within the specified date and time range.\n\n3. Calculate Available Slots - Once you have the existing appointments, calculate the gaps between them to find potential availability. Ensure each gap is at least as long as the required appointment length. Do not allow any overlap with existing appointments.\n\nBy following thesee steps, you can accurately find valid appointment windows based on the already-booked events.","operation":"getAll","calendar":{"__rl":true,"value":"tytom2003@gmail.com","mode":"list","cachedResultName":"tytom2003@gmail.com"},"timeMin":"={{ $fromAI('eventsAfter', 'Return events after this date time, use 2025-01-22T00:00:00 format') }}","timeMax":"={{ $fromAI('eventsBefore', 'Return events Before this date time, use 2025-01-22T00:00:00 format') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[500,280],"id":"503044aa-f9c7-4216-a1e2-ccee3578e464","name":"check_calendar_availability","credentials":{"googleCalendarOAuth2Api":{"id":"b0A4eBmee6hZKNup","name":"Google Calendar account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Use this send_email tool to send email to customer about booking information","sendTo":"={{ $fromAI('email') }}","subject":"ABC restaurant Booking","message":"=Booking Detail:\nDate: {{ $fromAI('date') }}\nTime: {{ $fromAI('eventsBefore') }}\n\nName: {{ $fromAI('name') }} \nEmail: {{ $fromAI('email') }} \nMobile: {{ $fromAI('mobile') }}\nPeople: {{ $fromAI(\"people\") }}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[800,280],"id":"ac0d78cd-3c1b-483c-8533-684e2fd3c2ec","name":"send_email","webhookId":"532ccfc3-8998-425a-a5a8-a6456425978d","credentials":{"gmailOAuth2":{"id":"8a85sqDVBZDlGGXt","name":"Gmail account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[120,280],"id":"e77479c0-2210-46df-b95f-0b70d340e063","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"44PUpUmLpSzRR1aa","name":"OpenRouter account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Use this create_appointment tool create a event schudule for customer.","calendar":{"__rl":true,"value":"tytom2003@gmail.com","mode":"list","cachedResultName":"tytom2003@gmail.com"},"start":"={{ $fromAI('eventsAfter', 'Return events after this date time, use 2025-01-22T00:00:00 format') }}","end":"={{ $fromAI('eventsBefore', 'Return events Before this date time, use 2025-01-22T00:00:00 format') }}","additionalFields":{"description":"=Name: {{ $fromAI('name') }} \nEmail: {{ $fromAI('email') }} \nMobile: {{ $fromAI('mobile') }}\nPeople: {{ $fromAI(\"people\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[660,280],"id":"21819ceb-07b8-4d2d-902e-60c1e21e4c6b","name":"create_appointment tool","credentials":{"googleCalendarOAuth2Api":{"id":"b0A4eBmee6hZKNup","name":"Google Calendar account"}}}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"check_calendar_availability":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"send_email":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"create_appointment tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"pinData":{},"meta":{"templateCredsSetupCompleted":true,"instanceId":"e64e0574627bbd29eaf930705e56c0d56b52beef0121590c955eb2feac06195c"}}